# Домашнее задание к занятию «Управляющие конструкции в коде Terraform»


### Задание 1

1. Инициализируем проект с предоставденным кодом: 

![изображение](https://github.com/user-attachments/assets/6864c54a-b82f-47c9-a1d1-72a97a42b9ca)

или

![изображение](https://github.com/user-attachments/assets/33d6ae75-d75c-40e2-b073-07ce2952cfb7)

------

### Задание 2

1. Создаем файл [count-vm.tf](count-vm.tf). Описываем в нём создание двух **одинаковых** ВМ  web-1 и web-2 (не web-0 и web-1) с минимальными параметрами, используя мета-аргумент **count loop**.

2. Создаем файл [for_each-vm.tf](for_each-vm.tf). Описываем в нём создание двух ВМ для баз данных с именами "main" и "replica" **разных** по cpu/ram/disk_volume , используя мета-аргумент **for_each loop**.  Правим файл переменных [variables.tf](variables.tf), где задаем параметры ВМ, используя для обеих ВМ одну общую переменную типа map(object()).
   
4. ВМ из пункта 2.1 должны создаваться после создания ВМ из пункта 2.2.
5. Используя функцию file в local-переменной для считывания ключа ~/.ssh/id_rsa.pub и его последующего использования в блоке metadata, взятому из ДЗ 2, получаем файл [locals.tf](locals.tf).

7. Инициализируем проект с полученным кодом:

![изображение](https://github.com/user-attachments/assets/a801097e-251e-4e48-9b63-30d63b8172e4)

------

### Задание 3

1. Создаем 3 одинаковых виртуальных диска размером 1 Гб с помощью ресурса yandex_compute_disk и мета-аргумента count в файле [disk_vm.tf](disk_vm.tf).
2. Создаем в том же файле **одиночную** ВМ c именем "storage", используя блок **dynamic secondary_disk{..}** и мета-аргумент for_each для подключения созданных вами дополнительных дисков.

![изображение](https://github.com/user-attachments/assets/4cd54f58-d4d4-40a5-9aa1-8d65162a27e7)

------

### Задание 4

1. В файле [ansible.tf](ansible.tf) создаем inventory-файл для ansible.
Используйте функцию tepmplatefile создаем запрос [ansible.tftpl](ansible.tftpl).
2. Инвентарь должен содержать 3 группы и быть динамическим, т. е. обработать как группу из 2-х ВМ, так и 999 ВМ.
3. Добавляем в инвентарь переменную **fqdn**.
4. Выполняем код:

![изображение](https://github.com/user-attachments/assets/56882df7-c81d-40c2-92d4-e2fe1bf53a2d)

------

## Дополнительные задания (со звездочкой*)

### Задание 5* (необязательное)
1. Создаем файл [output.tf](outputs.tf), который отобразит ВМ из ваших ресурсов count и for_each в виде списка словарей.

Скриншот вывода команды ```terrafrom output```:

![изображение](https://github.com/user-attachments/assets/fae7ff1c-aaee-49a3-9e67-61c28aa8c044)

------

### Задание 6* (необязательное)

### Задание 7* (необязательное)

### Задание 8* (необязательное)
Идентифицируйте и устраните намеренно допущенную в tpl-шаблоне ошибку. Обратите внимание, что terraform сам сообщит на какой строке и в какой позиции ошибка!
```
[webservers]
%{~ for i in webservers ~}
${i["name"]} ansible_host=${i["network_interface"][0]["nat_ip_address"] platform_id=${i["platform_id "]}}
%{~ endfor ~}
```
Не правильно установлен символ "}". Правильный код:

         ${i["name"]} ansible_host=${i["network_interface"][0]["nat_ip_address"]} platform_id=${i["platform_id"]}

### Задание 9* (необязательное)
Напишите terraform выражения, которые сформируют списки:
1. ["rc01","rc02","rc03","rc04",rc05","rc06",rc07","rc08","rc09","rc10....."rc99"] те список от "rc01" до "rc99"

         [for i in range(1,100) : format("%s%s", "rc", i)]

2. ["rc01","rc02","rc03","rc04",rc05","rc06","rc11","rc12","rc13","rc14",rc15","rc16","rc19"....."rc96"] те список от "rc01" до "rc96", пропуская все номера, заканчивающиеся на "0","7", "8", "9", за исключением "rc19"
 
         [for i in range(1,100) : format("%s%s", "rc", i) if (i%10 < 7 && i%10 > 0 || i == 19))]
